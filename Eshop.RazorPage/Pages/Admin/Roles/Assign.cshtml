@page "{roleId:long}"
@model Eshop.RazorPage.Pages.Admin.Roles.AssignModel
@{
    ViewData["Title"] = "انتساب کاربر به نقش";
    ViewData["selected"] = "roles";
}

<h3>انتساب کاربر به نقش <span class="text-primary">(@Model.RoleTitle)</span></h3>

<div class="card mt-3 p-3">
    <form method="post">
        <input type="hidden" name="RoleId" value="@Model.RoleId" />

        <div class="form-group mb-3">
            <label for="userSelect">انتخاب کاربر:</label>
            <select id="userSelect" class="form-control" name="UserId" required></select>
            <small class="form-text text-muted">
                می‌توانید با نام، نام خانوادگی، ایمیل یا شماره تلفن جستجو کنید.
            </small>
        </div>

        <button type="submit" class="btn btn-success">
            ثبت انتساب
        </button>
        <a asp-page="Index" class="btn btn-secondary">بازگشت</a>
    </form>
</div>

@section Scripts {
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#userSelect').select2({
                placeholder: 'جستجو با نام، نام خانوادگی، ایمیل یا شماره تلفن',
                allowClear: true,
                ajax: {
                    url: '@Url.Page("Assign", "SearchUsers", new { roleId = Model.RoleId })',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return { query: params.term };
                    },
                    processResults: function (data) {
                        return { results: data };
                    },
                    cache: true
                }
            });
        });
    </script>
}
